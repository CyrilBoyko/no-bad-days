{"ast":null,"code":"import _regeneratorRuntime from\"/Users/a1/Desktop/app/no-bad-days-social-network-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/a1/Desktop/app/no-bad-days-social-network-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/a1/Desktop/app/no-bad-days-social-network-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/a1/Desktop/app/no-bad-days-social-network-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{usersAPI}from\"../api/api\";import{updateObjectInArray}from\"../utils/validators/object-helpers\";var FOLLOW='FOLLOW';var UNFOLLOW='UNFOLLOW';var SET_USERS='SET_USERS';var SET_CURRENT_PAGE='SET_CURRENT_PAGE';var SET_TOTAL_USERS_COUNT='SET_TOTAL_USERS_COUNT';var TOGGLE_IS_FETCHING='TOGGLE_IS_FETCHING';var TOGGLE_IS_FOLLOWING_PROGRESS='TOGGLE_IS_FOLLOWING_PROGRESS';var initialState={users:[],pageSize:10,totalUsersCount:0,currentPage:1,isFetching:true,followingInProgress:[]// array of users ids\n};var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:return _objectSpread({},state,{users:updateObjectInArray(state.users,action.userId,'id',{followed:true})});case UNFOLLOW:return _objectSpread({},state,{users:updateObjectInArray(state.users,action.userId,'id',{followed:false})});case SET_USERS:{return _objectSpread({},state,{users:action.users});}case SET_CURRENT_PAGE:{return _objectSpread({},state,{currentPage:action.currentPage});}case SET_TOTAL_USERS_COUNT:{return _objectSpread({},state,{totalUsersCount:action.count});}case TOGGLE_IS_FETCHING:{return _objectSpread({},state,{isFetching:action.isFetching});}case TOGGLE_IS_FOLLOWING_PROGRESS:{return _objectSpread({},state,{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!==action.userId;})});}default:return state;}};export var followSuccess=function followSuccess(userId){return{type:FOLLOW,userId:userId};};export var unfollowSuccess=function unfollowSuccess(userId){return{type:UNFOLLOW,userId:userId};};export var setUsers=function setUsers(users){return{type:SET_USERS,users:users};};export var setCurrentPage=function setCurrentPage(currentPage){return{type:SET_CURRENT_PAGE,currentPage:currentPage};};export var setTotalUsersCount=function setTotalUsersCount(totalUsersCount){return{type:SET_TOTAL_USERS_COUNT,count:totalUsersCount};};export var toggleIsFetching=function toggleIsFetching(isFetching){return{type:TOGGLE_IS_FETCHING,isFetching:isFetching};};export var toggleFollowingProgress=function toggleFollowingProgress(isFetching,userId){return{type:TOGGLE_IS_FOLLOWING_PROGRESS,isFetching:isFetching,userId:userId};};export var requestUsers=function requestUsers(page,pageSize){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(toggleIsFetching(true));dispatch(setCurrentPage(page));_context.next=4;return usersAPI.getUsers(page,pageSize);case 4:data=_context.sent;dispatch(toggleIsFetching(false));dispatch(setUsers(data.items));dispatch(setTotalUsersCount(data.totalCount));case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,userId,apiMethod,actionCreator){var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(toggleFollowingProgress(true,userId));_context2.next=3;return apiMethod(userId);case 3:data=_context2.sent;if(data.resultCode===0){dispatch(actionCreator(userId));}dispatch(toggleFollowingProgress(false,userId));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function followUnfollowFlow(_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:followUnfollowFlow(dispatch,userId,usersAPI.unfollow.bind(usersAPI),unfollowSuccess);case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x6){return _ref3.apply(this,arguments);};}();};export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:followUnfollowFlow(dispatch,userId,usersAPI.follow.bind(usersAPI),followSuccess);case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x7){return _ref4.apply(this,arguments);};}();};export default usersReducer;","map":{"version":3,"sources":["/Users/a1/Desktop/app/no-bad-days-social-network-demo/src/redux/users-reducer.ts"],"names":["usersAPI","updateObjectInArray","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_USERS_COUNT","TOGGLE_IS_FETCHING","TOGGLE_IS_FOLLOWING_PROGRESS","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","userId","followed","count","filter","id","followSuccess","unfollowSuccess","setUsers","setCurrentPage","setTotalUsersCount","toggleIsFetching","toggleFollowingProgress","requestUsers","page","dispatch","getUsers","data","items","totalCount","followUnfollowFlow","apiMethod","actionCreator","resultCode","unfollow","bind","follow"],"mappings":"orBAAA,OAAQA,QAAR,KAAuB,YAAvB,CACA,OAAQC,mBAAR,KAAkC,oCAAlC,CAGA,GAAMC,CAAAA,MAAM,CAAG,QAAf,CACA,GAAMC,CAAAA,QAAQ,CAAG,UAAjB,CACA,GAAMC,CAAAA,SAAS,CAAG,WAAlB,CACA,GAAMC,CAAAA,gBAAgB,CAAG,kBAAzB,CACA,GAAMC,CAAAA,qBAAqB,CAAG,uBAA9B,CACA,GAAMC,CAAAA,kBAAkB,CAAG,oBAA3B,CACA,GAAMC,CAAAA,4BAA4B,CAAG,8BAArC,CAEA,GAAIC,CAAAA,YAAY,CAAG,CACfC,KAAK,CAAE,EADQ,CAEfC,QAAQ,CAAE,EAFK,CAGfC,eAAe,CAAE,CAHF,CAIfC,WAAW,CAAE,CAJE,CAKfC,UAAU,CAAE,IALG,CAMfC,mBAAmB,CAAE,EAAoB;AAN1B,CAAnB,CAWA,GAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAyD,IAAxDC,CAAAA,KAAwD,2DAAhDR,YAAgD,IAAlCS,CAAAA,MAAkC,2CAC1E,OAAQA,MAAM,CAACC,IAAf,EACI,IAAKjB,CAAAA,MAAL,CACI,wBACOe,KADP,EAEIP,KAAK,CAAET,mBAAmB,CAACgB,KAAK,CAACP,KAAP,CAAcQ,MAAM,CAACE,MAArB,CAA6B,IAA7B,CAAmC,CAACC,QAAQ,CAAE,IAAX,CAAnC,CAF9B,GAIJ,IAAKlB,CAAAA,QAAL,CACI,wBACOc,KADP,EAEIP,KAAK,CAAET,mBAAmB,CAACgB,KAAK,CAACP,KAAP,CAAcQ,MAAM,CAACE,MAArB,CAA6B,IAA7B,CAAmC,CAACC,QAAQ,CAAE,KAAX,CAAnC,CAF9B,GAIJ,IAAKjB,CAAAA,SAAL,CAAgB,CACZ,wBACOa,KADP,EAEIP,KAAK,CAAEQ,MAAM,CAACR,KAFlB,GAIH,CACD,IAAKL,CAAAA,gBAAL,CAAuB,CACnB,wBACOY,KADP,EAEIJ,WAAW,CAAEK,MAAM,CAACL,WAFxB,GAIH,CACD,IAAKP,CAAAA,qBAAL,CAA4B,CACxB,wBACOW,KADP,EAEIL,eAAe,CAAEM,MAAM,CAACI,KAF5B,GAIH,CACD,IAAKf,CAAAA,kBAAL,CAAyB,CACrB,wBACOU,KADP,EAEIH,UAAU,CAAEI,MAAM,CAACJ,UAFvB,GAIH,CACD,IAAKN,CAAAA,4BAAL,CAAmC,CAC/B,wBACOS,KADP,EAEIF,mBAAmB,CAAEG,MAAM,CAACJ,UAAP,8BACXG,KAAK,CAACF,mBADK,GACgBG,MAAM,CAACE,MADvB,GAEfH,KAAK,CAACF,mBAAN,CAA0BQ,MAA1B,CAAiC,SAAAC,EAAE,QAAIA,CAAAA,EAAE,GAAKN,MAAM,CAACE,MAAlB,EAAnC,CAJV,GAMH,CACD,QACI,MAAOH,CAAAA,KAAP,CA5CR,CA8CH,CA/CD,CAsDA,MAAO,IAAMQ,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACL,MAAD,QAA8C,CAACD,IAAI,CAAEjB,MAAP,CAAekB,MAAM,CAANA,MAAf,CAA9C,EAAtB,CAOP,MAAO,IAAMM,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACN,MAAD,QAAgD,CAACD,IAAI,CAAEhB,QAAP,CAAiBiB,MAAM,CAANA,MAAjB,CAAhD,EAAxB,CAOP,MAAO,IAAMO,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACjB,KAAD,QAAiD,CAACS,IAAI,CAAEf,SAAP,CAAkBM,KAAK,CAALA,KAAlB,CAAjD,EAAjB,CAOP,MAAO,IAAMkB,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACf,WAAD,QAAoD,CAACM,IAAI,CAAEd,gBAAP,CAAyBQ,WAAW,CAAXA,WAAzB,CAApD,EAAvB,CAOP,MAAO,IAAMgB,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACjB,eAAD,QAA4D,CAACO,IAAI,CAAEb,qBAAP,CAA8BgB,KAAK,CAAEV,eAArC,CAA5D,EAA3B,CAOP,MAAO,IAAMkB,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAAChB,UAAD,QAAsD,CAACK,IAAI,CAAEZ,kBAAP,CAA2BO,UAAU,CAAVA,UAA3B,CAAtD,EAAzB,CAQP,MAAO,IAAMiB,CAAAA,uBAAuB,CAAG,QAA1BA,CAAAA,uBAA0B,CAACjB,UAAD,CAAsBM,MAAtB,QAA6E,CAChHD,IAAI,CAAEX,4BAD0G,CAEhHM,UAAU,CAAVA,UAFgH,CAGhHM,MAAM,CAANA,MAHgH,CAA7E,EAAhC,CAMP,MAAO,IAAMY,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,IAAD,CAAetB,QAAf,CAAoC,CAC5D,+FAAO,iBAAOuB,QAAP,2HAEHA,QAAQ,CAACJ,gBAAgB,CAAC,IAAD,CAAjB,CAAR,CACAI,QAAQ,CAACN,cAAc,CAACK,IAAD,CAAf,CAAR,CAHG,sBAKcjC,CAAAA,QAAQ,CAACmC,QAAT,CAAkBF,IAAlB,CAAwBtB,QAAxB,CALd,QAKCyB,IALD,eAMHF,QAAQ,CAACJ,gBAAgB,CAAC,KAAD,CAAjB,CAAR,CACAI,QAAQ,CAACP,QAAQ,CAACS,IAAI,CAACC,KAAN,CAAT,CAAR,CACAH,QAAQ,CAACL,kBAAkB,CAACO,IAAI,CAACE,UAAN,CAAnB,CAAR,CARG,sDAAP,+DAUH,CAXM,CAaP,GAAMC,CAAAA,kBAAkB,2FAAG,kBAAOL,QAAP,CAAsBd,MAAtB,CAAsCoB,SAAtC,CAAsDC,aAAtD,+HACvBP,QAAQ,CAACH,uBAAuB,CAAC,IAAD,CAAOX,MAAP,CAAxB,CAAR,CADuB,uBAENoB,CAAAA,SAAS,CAACpB,MAAD,CAFH,QAEnBgB,IAFmB,gBAGvB,GAAIA,IAAI,CAACM,UAAL,GAAoB,CAAxB,CAA2B,CACvBR,QAAQ,CAACO,aAAa,CAACrB,MAAD,CAAd,CAAR,CACH,CACDc,QAAQ,CAACH,uBAAuB,CAAC,KAAD,CAAQX,MAAR,CAAxB,CAAR,CANuB,wDAAH,kBAAlBmB,CAAAA,kBAAkB,0DAAxB,CASA,MAAO,IAAMI,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACvB,MAAD,CAAoB,CACxC,gGAAO,kBAAOc,QAAP,sHACHK,kBAAkB,CAACL,QAAD,CAAWd,MAAX,CAAmBpB,QAAQ,CAAC2C,QAAT,CAAkBC,IAAlB,CAAuB5C,QAAvB,CAAnB,CAAqD0B,eAArD,CAAlB,CADG,wDAAP,iEAGH,CAJM,CAKP,MAAO,IAAMmB,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAACzB,MAAD,CAAoB,CACtC,gGAAO,kBAAOc,QAAP,sHACHK,kBAAkB,CAACL,QAAD,CAAWd,MAAX,CAAmBpB,QAAQ,CAAC6C,MAAT,CAAgBD,IAAhB,CAAqB5C,QAArB,CAAnB,CAAmDyB,aAAnD,CAAlB,CADG,wDAAP,iEAGH,CAJM,CAMP,cAAeT,CAAAA,YAAf","sourcesContent":["import {usersAPI} from \"../api/api\";\nimport {updateObjectInArray} from \"../utils/validators/object-helpers\";\nimport {UserType} from \"../types/types\";\n\nconst FOLLOW = 'FOLLOW';\nconst UNFOLLOW = 'UNFOLLOW';\nconst SET_USERS = 'SET_USERS';\nconst SET_CURRENT_PAGE = 'SET_CURRENT_PAGE';\nconst SET_TOTAL_USERS_COUNT = 'SET_TOTAL_USERS_COUNT';\nconst TOGGLE_IS_FETCHING = 'TOGGLE_IS_FETCHING';\nconst TOGGLE_IS_FOLLOWING_PROGRESS = 'TOGGLE_IS_FOLLOWING_PROGRESS';\n\nlet initialState = {\n    users: [] as Array<UserType>,\n    pageSize: 10,\n    totalUsersCount: 0,\n    currentPage: 1,\n    isFetching: true,\n    followingInProgress: [] as Array<number> // array of users ids\n};\n\ntype InitialStateType = typeof initialState\n\nconst usersReducer = (state = initialState, action: any): InitialStateType => {\n    switch (action.type) {\n        case FOLLOW:\n            return {\n                ...state,\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: true})\n            };\n        case UNFOLLOW:\n            return {\n                ...state,\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: false})\n            };\n        case SET_USERS: {\n            return {\n                ...state,\n                users: action.users\n            }\n        }\n        case SET_CURRENT_PAGE: {\n            return {\n                ...state,\n                currentPage: action.currentPage\n            }\n        }\n        case SET_TOTAL_USERS_COUNT: {\n            return {\n                ...state,\n                totalUsersCount: action.count\n            }\n        }\n        case TOGGLE_IS_FETCHING: {\n            return {\n                ...state,\n                isFetching: action.isFetching\n            }\n        }\n        case TOGGLE_IS_FOLLOWING_PROGRESS: {\n            return {\n                ...state,\n                followingInProgress: action.isFetching\n                    ? [...state.followingInProgress, action.userId]\n                    : state.followingInProgress.filter(id => id !== action.userId)\n            }\n        }\n        default:\n            return state;\n    }\n};\n\ntype FollowSuccessActionType = {\n    type: typeof FOLLOW\n    userId: number\n}\n\nexport const followSuccess = (userId: number): FollowSuccessActionType => ({type: FOLLOW, userId});\n\ntype UnfollowSuccessActionType = {\n    type: typeof UNFOLLOW\n    userId: number\n}\n\nexport const unfollowSuccess = (userId: number): UnfollowSuccessActionType => ({type: UNFOLLOW, userId});\n\ntype SetUsersActionType = {\n    type: typeof SET_USERS\n    users: Array<UserType>\n}\n\nexport const setUsers = (users: Array<UserType>): SetUsersActionType => ({type: SET_USERS, users});\n\ntype SetCurrentPageActionType = {\n    type: typeof SET_CURRENT_PAGE\n    currentPage: number\n}\n\nexport const setCurrentPage = (currentPage: number): SetCurrentPageActionType => ({type: SET_CURRENT_PAGE, currentPage});\n\ntype SetTotalUsersCountActionType = {\n    type: typeof SET_TOTAL_USERS_COUNT\n    count: number\n}\n\nexport const setTotalUsersCount = (totalUsersCount: number): SetTotalUsersCountActionType => ({type: SET_TOTAL_USERS_COUNT, count: totalUsersCount});\n\ntype ToggleIsFetchingActionType = {\n    type: typeof TOGGLE_IS_FETCHING\n    isFetching: boolean\n}\n\nexport const toggleIsFetching = (isFetching: boolean): ToggleIsFetchingActionType => ({type: TOGGLE_IS_FETCHING, isFetching});\n\ntype ToggleFollowingProgressActionType = {\n    type: typeof TOGGLE_IS_FOLLOWING_PROGRESS\n    isFetching: boolean\n    userId: number\n}\n\nexport const toggleFollowingProgress = (isFetching: boolean, userId: number): ToggleFollowingProgressActionType => ({\n    type: TOGGLE_IS_FOLLOWING_PROGRESS,\n    isFetching,\n    userId\n});\n\nexport const requestUsers = (page: number, pageSize: number) => {\n    return async (dispatch: any) => {\n\n        dispatch(toggleIsFetching(true));\n        dispatch(setCurrentPage(page));\n\n        let data = await usersAPI.getUsers(page, pageSize);\n        dispatch(toggleIsFetching(false));\n        dispatch(setUsers(data.items));\n        dispatch(setTotalUsersCount(data.totalCount));\n    }\n};\n\nconst followUnfollowFlow = async (dispatch: any, userId: number, apiMethod: any, actionCreator: any) => {\n    dispatch(toggleFollowingProgress(true, userId));\n    let data = await apiMethod(userId);\n    if (data.resultCode === 0) {\n        dispatch(actionCreator(userId));\n    }\n    dispatch(toggleFollowingProgress(false, userId));\n};\n\nexport const unfollow = (userId: number) => {\n    return async (dispatch: any) => {\n        followUnfollowFlow(dispatch, userId, usersAPI.unfollow.bind(usersAPI), unfollowSuccess);\n    }\n};\nexport const follow = (userId: number) => {\n    return async (dispatch: any) => {\n        followUnfollowFlow(dispatch, userId, usersAPI.follow.bind(usersAPI), followSuccess);\n    }\n};\n\nexport default usersReducer;"]},"metadata":{},"sourceType":"module"}