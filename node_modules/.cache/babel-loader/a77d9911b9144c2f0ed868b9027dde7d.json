{"ast":null,"code":"import _regeneratorRuntime from\"/Users/a1/Desktop/app/no-bad-days-social-network-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/a1/Desktop/app/no-bad-days-social-network-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/a1/Desktop/app/no-bad-days-social-network-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/a1/Desktop/app/no-bad-days-social-network-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{updateObjectInArray}from\"../utils/validators/object-helpers\";import{usersAPI}from\"../api/users-api\";var initialState={users:[],pageSize:10,totalUsersCount:0,currentPage:1,isFetching:true,followingInProgress:[]// array of users ids\n};var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case'SN/USERS/FOLLOW':return _objectSpread({},state,{users:updateObjectInArray(state.users,action.userId,'id',{followed:true})});case'SN/USERS/UNFOLLOW':return _objectSpread({},state,{users:updateObjectInArray(state.users,action.userId,'id',{followed:false})});case'SN/USERS/SET_USERS':{return _objectSpread({},state,{users:action.users});}case'SN/USERS/SET_CURRENT_PAGE':{return _objectSpread({},state,{currentPage:action.currentPage});}case'SN/USERS/SET_TOTAL_USERS_COUNT':{return _objectSpread({},state,{totalUsersCount:action.count});}case'SN/USERS/TOGGLE_IS_FETCHING':{return _objectSpread({},state,{isFetching:action.isFetching});}case'SN/USERS/TOGGLE_IS_FOLLOWING_PROGRESS':{return _objectSpread({},state,{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!==action.userId;})});}default:return state;}};export var actions={followSuccess:function followSuccess(userId){return{type:'SN/USERS/FOLLOW',userId:userId};},unfollowSuccess:function unfollowSuccess(userId){return{type:'SN/USERS/UNFOLLOW',userId:userId};},setUsers:function setUsers(users){return{type:'SN/USERS/SET_USERS',users:users};},setCurrentPage:function setCurrentPage(currentPage){return{type:'SN/USERS/SET_CURRENT_PAGE',currentPage:currentPage};},setTotalUsersCount:function setTotalUsersCount(totalUsersCount){return{type:'SN/USERS/SET_TOTAL_USERS_COUNT',count:totalUsersCount};},toggleIsFetching:function toggleIsFetching(isFetching){return{type:'SN/USERS/TOGGLE_IS_FETCHING',isFetching:isFetching};},toggleFollowingProgress:function toggleFollowingProgress(isFetching,userId){return{type:'SN/USERS/TOGGLE_IS_FOLLOWING_PROGRESS',isFetching:isFetching,userId:userId};}};export var requestUsers=function requestUsers(page,pageSize){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch,getState){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(actions.toggleIsFetching(true));dispatch(actions.setCurrentPage(page));_context.next=4;return usersAPI.getUsers(page,pageSize);case 4:data=_context.sent;dispatch(actions.toggleIsFetching(false));dispatch(actions.setUsers(data.items));dispatch(actions.setTotalUsersCount(data.totalCount));case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();};var _followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,userId,apiMethod,actionCreator){var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(actions.toggleFollowingProgress(true,userId));_context2.next=3;return apiMethod(userId);case 3:data=_context2.sent;if(data.resultCode===0){dispatch(actionCreator(userId));}dispatch(actions.toggleFollowingProgress(false,userId));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function _followUnfollowFlow(_x3,_x4,_x5,_x6){return _ref2.apply(this,arguments);};}();export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_followUnfollowFlow(dispatch,userId,usersAPI.unfollow.bind(usersAPI),actions.unfollowSuccess);case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x7){return _ref3.apply(this,arguments);};}();};export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_followUnfollowFlow(dispatch,userId,usersAPI.follow.bind(usersAPI),actions.followSuccess);case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x8){return _ref4.apply(this,arguments);};}();};export default usersReducer;","map":{"version":3,"sources":["/Users/a1/Desktop/app/no-bad-days-social-network-demo/src/redux/users-reducer.ts"],"names":["updateObjectInArray","usersAPI","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","userId","followed","count","filter","id","actions","followSuccess","unfollowSuccess","setUsers","setCurrentPage","setTotalUsersCount","toggleIsFetching","toggleFollowingProgress","requestUsers","page","dispatch","getState","getUsers","data","items","totalCount","_followUnfollowFlow","apiMethod","actionCreator","resultCode","unfollow","bind","follow"],"mappings":"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","sourcesContent":["import {updateObjectInArray} from \"../utils/validators/object-helpers\";\nimport {UserType} from \"../types/types\";\nimport {BaseThunkType, InferActionsTypes} from \"./redux-store\";\nimport {Dispatch} from \"redux\";\nimport {usersAPI} from \"../api/users-api\";\n\nlet initialState = {\n    users: [] as Array<UserType>,\n    pageSize: 10,\n    totalUsersCount: 0,\n    currentPage: 1,\n    isFetching: true,\n    followingInProgress: [] as Array<number> // array of users ids\n};\n\nconst usersReducer = (state = initialState, action: ActionsTypes): InitialStateType => {\n    switch (action.type) {\n        case 'SN/USERS/FOLLOW':\n            return {\n                ...state,\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: true})\n            };\n        case 'SN/USERS/UNFOLLOW':\n            return {\n                ...state,\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: false})\n            };\n        case 'SN/USERS/SET_USERS': {\n            return {\n                ...state,\n                users: action.users\n            }\n        }\n        case 'SN/USERS/SET_CURRENT_PAGE': {\n            return {\n                ...state,\n                currentPage: action.currentPage\n            }\n        }\n        case 'SN/USERS/SET_TOTAL_USERS_COUNT': {\n            return {\n                ...state,\n                totalUsersCount: action.count\n            }\n        }\n        case 'SN/USERS/TOGGLE_IS_FETCHING': {\n            return {\n                ...state,\n                isFetching: action.isFetching\n            }\n        }\n        case 'SN/USERS/TOGGLE_IS_FOLLOWING_PROGRESS': {\n            return {\n                ...state,\n                followingInProgress: action.isFetching\n                    ? [...state.followingInProgress, action.userId]\n                    : state.followingInProgress.filter(id => id !== action.userId)\n            }\n        }\n        default:\n            return state;\n    }\n};\n\nexport const actions = {\n    followSuccess: (userId: number) => ({type: 'SN/USERS/FOLLOW', userId} as const),\n\n    unfollowSuccess: (userId: number) => ({type: 'SN/USERS/UNFOLLOW', userId} as const),\n\n    setUsers: (users: Array<UserType>) => ({type: 'SN/USERS/SET_USERS', users} as const),\n\n    setCurrentPage: (currentPage: number) => ({\n        type: 'SN/USERS/SET_CURRENT_PAGE',\n        currentPage\n    } as const),\n\n    setTotalUsersCount: (totalUsersCount: number) => ({\n        type: 'SN/USERS/SET_TOTAL_USERS_COUNT',\n        count: totalUsersCount\n    } as const),\n\n    toggleIsFetching: (isFetching: boolean) => ({\n        type: 'SN/USERS/TOGGLE_IS_FETCHING',\n        isFetching\n    } as const),\n\n    toggleFollowingProgress: (isFetching: boolean,\n                              userId: number) => ({\n        type: 'SN/USERS/TOGGLE_IS_FOLLOWING_PROGRESS',\n        isFetching,\n        userId\n    } as const)\n};\n\nexport const requestUsers = (page: number,\n                             pageSize: number): ThunkType => {\n    return async (dispatch, getState) => {\n\n        dispatch(actions.toggleIsFetching(true));\n        dispatch(actions.setCurrentPage(page));\n\n        let data = await usersAPI.getUsers(page, pageSize);\n        dispatch(actions.toggleIsFetching(false));\n        dispatch(actions.setUsers(data.items));\n        dispatch(actions.setTotalUsersCount(data.totalCount));\n    }\n};\n\nconst _followUnfollowFlow = async (dispatch: Dispatch<ActionsTypes>,\n                                   userId: number,\n                                   apiMethod: any,\n                                   actionCreator: (userId: number) => ActionsTypes) => {\n    dispatch(actions.toggleFollowingProgress(true, userId));\n    let data = await apiMethod(userId);\n    if (data.resultCode === 0) {\n        dispatch(actionCreator(userId));\n    }\n    dispatch(actions.toggleFollowingProgress(false, userId));\n};\n\nexport const unfollow = (userId: number): ThunkType => {\n    return async (dispatch) => {\n        _followUnfollowFlow(dispatch, userId, usersAPI.unfollow.bind(usersAPI), actions.unfollowSuccess);\n    }\n};\nexport const follow = (userId: number): ThunkType => {\n    return async (dispatch) => {\n        _followUnfollowFlow(dispatch, userId, usersAPI.follow.bind(usersAPI), actions.followSuccess);\n    }\n};\n\nexport default usersReducer;\n\ntype InitialStateType = typeof initialState\n\ntype ThunkType = BaseThunkType<ActionsTypes>\n\ntype ActionsTypes = InferActionsTypes<typeof actions>\n"]},"metadata":{},"sourceType":"module"}